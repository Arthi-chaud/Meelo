FROM arthichaud/gocv-alpine AS base
RUN go install github.com/bokwoon95/wgo@latest && \
	go install github.com/swaggo/swag/cmd/swag@latest

RUN apk update && apk upgrade && apk add ffmpeg chromaprint mailcap make cmake sudo curl pkgconf g++ linux-headers

WORKDIR /app

COPY go.mod go.sum .
ENV CGO_ENABLED=1

WORKDIR /app
ENV VERSION=dev
CMD ["wgo", "-xdir", "./app/docs", "swag", "init", "-d", "app", "-o", "./app/docs", "::", "go", "run", "./app"]
